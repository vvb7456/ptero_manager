<!-- templates/_activity_logs.html -->
<hgroup>
    <h2>活动日志</h2>
    <p>查看系统自动化任务和管理员操作的详细记录。</p>
</hgroup>

<!-- 筛选表单 -->
<form method="get" action="{{ url_for('activity_logs') }}">
    <div class="grid">
        <select name="actor">
            <option value="">所有执行者</option>
            {% for actor in distinct_actors %}
                <option value="{{ actor }}" {% if request.args.get('actor') == actor %}selected{% endif %}>{{ actor }}</option>
            {% endfor %}
        </select>
        <select name="action">
            <option value="">所有操作类型</option>
            {% for action in distinct_actions %}
                <option value="{{ action }}" {% if request.args.get('action') == action %}selected{% endif %}>{{ action }}</option>
            {% endfor %}
        </select>
        <select name="status">
            <option value="">所有状态</option>
            <option value="成功" {% if request.args.get('status') == '成功' %}selected{% endif %}>成功</option>
            <option value="失败" {% if request.args.get('status') == '失败' %}selected{% endif %}>失败</option>
            <option value="信息" {% if request.args.get('status') == '信息' %}selected{% endif %}>信息</option>
        </select>
        <button type="submit">筛选</button>
    </div>
</form>

<!-- 日志表格 -->
<figure>
    <table role="grid">
        <thead>
            <tr>
                <th scope="col">时间 (CST)</th>
                <th scope="col">执行者</th>
                <th scope="col">操作类型</th>
                <th scope="col">状态</th>
                <th scope="col">详细信息</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.timestamp | localtime }}</td>
                <td>{{ log.actor }}</td>
                <td><code>{{ log.action }}</code></td>
                <td>
                    {% if log.status == '成功' %}
                        <span class="status-normal">成功</span>
                    {% elif log.status == '失败' %}
                        <span class="status-expired">失败</span>
                    {% else %}
                        <span class="status-suspended">信息</span>
                    {% endif %}
                </td>
                <td>{{ log.details }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5">没有找到符合条件的日志记录。</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</figure>

<!-- 分页导航 -->
{% if pagination and pagination.pages > 1 %}
<nav>
    <ul>
        {% if pagination.has_prev %}
            <li><a href="{{ url_for('activity_logs', page=pagination.prev_num, **request.args) }}" rel="prev">‹ 上一页</a></li>
        {% else %}
            <li><span role="link" aria-disabled="true">‹ 上一页</span></li>
        {% endif %}
    </ul>
    <ul>
        <li>Page {{ pagination.page }} of {{ pagination.pages }}</li>
    </ul>
    <ul>
        {% if pagination.has_next %}
            <li><a href="{{ url_for('activity_logs', page=pagination.next_num, **request.args) }}" rel="next">下一页 ›</a></li>
        {% else %}
            <li><span role="link" aria-disabled="true">下一页 ›</span></li>
        {% endif %}
    </ul>
</nav>
{% endif %}
